<!doctype html>
<html><!-- InstanceBegin template="/Templates/temp.dwt" codeOutsideHTMLIsLocked="false" -->
	<head>
		  <!-- Required meta tags -->
	  <meta charset="utf-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	  <!-- InstanceBeginEditable name="doctitle" -->
	  <title>产品分类管理</title>
	  <!-- InstanceEndEditable -->
	  <!-- plugins:css -->
	  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
	  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
	  <!-- endinject -->
	  <!-- plugin css for this page -->
	  <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
	  <!-- End plugin css for this page -->
	  <!-- inject:css -->
	  <link rel="stylesheet" href="css/style.css">
	  <!-- endinject -->
	  <link rel="shortcut icon" href="images/favicon.png" />
	  <script src="vendors/base/vendor.bundle.base.js"></script>
	  <script src="js/common.js"></script>
	  <!-- InstanceBeginEditable name="head" -->
	  <link rel="stylesheet" href="css/pagination.css">
	  <script src="js/pagination.min.js"></script>
	  <script src="js/jquery.poplayer.js"></script>
	  <!-- InstanceEndEditable -->
	</head>

	<body>
		
		<div class="container-scroller">
		  <!-- partial:partials/_navbar.html -->
  		  <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
              <div class="navbar-brand-wrapper d-flex justify-content-center">
				<div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">  
				  <a class="navbar-brand brand-logo" href="index.html"><img src="images/logo22.png" alt="logo" height="60"/></a>
				  <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/logo.png" alt="logo"/></a>
				  <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
					<span class="mdi mdi-sort-variant"></span>
				  </button>
				</div>  
			  </div>
			  <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">

				<ul class="navbar-nav navbar-nav-right">

				  <li class="nav-item nav-profile dropdown">
					<a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" id="profileDropdown">
					  <span class="nav-profile-name">这里是用户名</span>
					</a>
					<div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
					  <a class="dropdown-item">
						<i class="mdi mdi-settings text-primary"></i>
						修改密码
					  </a>
					  <a class="dropdown-item">
						<i class="mdi mdi-logout text-primary"></i>
						退出登录
					  </a>
					</div>
				  </li>
				</ul>
				<button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
				  <span class="mdi mdi-menu"></span>
				</button>
			  </div>
		  </nav>
		  <div class="container-fluid page-body-wrapper">
			   <!-- partial:partials/_sidebar.html -->
			  <nav class="sidebar sidebar-offcanvas" id="sidebar">
				<ul class="nav">
				  <li class="nav-item">
					<a class="nav-link" href="manage.html">
					  <i class="mdi mdi-home menu-icon"></i>
					  <span class="menu-title">首页</span>
					</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
					  <i class="mdi mdi-circle-outline menu-icon"></i>
					  <span class="menu-title">轮播图管理</span>
					  <i class="menu-arrow"></i>
					</a>
					<div class="collapse" id="ui-basic">
					  <ul class="nav flex-column sub-menu">
						<li class="nav-item"> <a class="nav-link" href="banner_default.html">首页轮播图</a></li>
						<li class="nav-item"> <a class="nav-link" href="banner_cabi.html">察必页轮播图</a></li>
					  </ul>
					</div>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" href="product_type.html">
					  <i class="mdi mdi-view-headline menu-icon"></i>
					  <span class="menu-title">产品系列管理</span>
					</a>
				  </li>

				  <li class="nav-item">
					<a class="nav-link" href="product_manage.html">
					  <i class="mdi mdi-grid-large menu-icon"></i>
					  <span class="menu-title">产品管理</span>
					</a>
				  </li>
					
				  <li class="nav-item">
					<a class="nav-link" href="pages/tables/basic-table.html">
					  <i class="mdi mdi-book-variant menu-icon"></i>
					  <span class="menu-title">预约管理</span>
					</a>
				  </li>
					
				  <li class="nav-item">
					<a class="nav-link" data-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
					  <i class="mdi mdi-account menu-icon"></i>
					  <span class="menu-title">个人用户设置</span>
					  <i class="menu-arrow"></i>
					</a>
					<div class="collapse" id="auth">
					  <ul class="nav flex-column sub-menu">
						<li class="nav-item"> <a class="nav-link" href="pages/samples/login.html">修改密码</a></li>
						<li class="nav-item"> <a class="nav-link" href="pages/samples/login-2.html">退出登录</a></li>
					  </ul>
					</div>
				  </li>
				</ul>
			  </nav>
			  
			        <!-- partial -->
			  <div class="main-panel">
				<div class="content-wrapper">
					<!-- InstanceBeginEditable name="ConetentArea" -->
					
					<div class="col-lg grid-margin stretch-card">
					  <div class="card">
						<div class="card-body">
						  <h4 class="card-title d-flex justify-content-between align-items-center">
							  <div>产品系列表</div>
							  <a id="avatar" class="btn btn-primary btn-sm text-white">添加产品分类</a>
						  </h4>
						  <p class="card-description">
							  您共有<code id="count">5</code>个产品系列
						  </p>
						  <div class="table-responsive">
							<table class="table">
							  <thead>
								<tr>
								  <th>#</th>
								  <th><b>系列名字</b></th>
								  <th><b>产品总数</b></th>
								  <th><b>上架产品数</b></th>
								  <th><b>状态</b></th>
								  <th><b>操作</b></th>
								</tr>
							  </thead>
							  <tbody id="list_table">
								<tr>
								  <td>加载中..</td>  
								</tr>
							  </tbody>
							</table>
						  </div>
						</div>
					  </div>
					</div>
					
	
					
					
					<div class="p-3" id="add_type_wrap">
						  <div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel" style="font-weight: bold;">添加产品分类</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close" onClick="$.closePopLayer()">
							  <span aria-hidden="true">&times;</span>
							</button>
						  </div>
						  <div class="modal-body">
							  <form>
								 <div class="form-group">
								   <label for="recipient-name" class="col-form-label">分类名称:</label>
								   <input type="text" class="form-control" id="type_name">
								   <div id="name_alert" class="alert alert-danger m-0 mt-3 p-2" style="font-size: 0.75rem; display: none;" role="alert">
  									   请输入分类名称
								   </div>
								 </div>
							  </form>

						  </div>
						  <div class="modal-footer pr-0">
							  <button id="btn_add_type" type="button" class="btn btn-primary">确定</button>
						  </div>

					</div>
					
					
					
					<script>
						getTypeList();
						
						$("#avatar").click(function(){
							$.showPopLayer({
								target:'add_type_wrap'
							})
						});
						
						
						$("#type_name").on('input',function(){
							$(this).next().hide();
						})
						
						
						$("#btn_add_type").click(function(){
							var tName=$("#type_name").val();
							if($.trim(tName)==""){
								$("#name_alert").show();
							}else{
								$.post('https://customer.imotstudio.net/cabi/api/product/AddType?TypeName='+tName).done(function(res){
									console.log(res);
									if(res.Code=="400"){
										$("#name_alert").text(res.Message).show();
									}else{
										$.closePopLayer();
										getTypeList();
										$("#name_alert").text("请输入分类名称").hide();
										
									}
								});
							}
							
						})
						
						
						//获取产品分类
						function getTypeList(){
							$.get("https://customer.imotstudio.net/cabi/api/product/GetProductTypeForBack").done(function(res){
								
								if(res.Code=="200"){
									$("#count").text(res.Data.length);
									if(res.Data.length>0){
										$("#list_table").empty();
										$.each(res.Data,function(i,o){
											var html='<tr>\
													  <td>'+(i+1)+'</td>\
													  <td>'+o.Title+'</td>\
													  <td>'+o.count+'</td>\
													  <td>'+o.isShowing+'</td>\
													  <td><label class="badge badge-success">展示中</label></td>\
													  <td>\
														  <button data-tid="'+o.ID+'" class="btn btn-warning btn-sm btn-down" style="font-size:0.75rem; line-height:0.75rem;" onclick="updown('+o.ID+',0)">下架</button>\
 														  <button data-tid="'+o.ID+'" class="btn btn-primary btn-sm btn-up" style="font-size:0.75rem; line-height:0.75rem; display:none" onclick="updown('+o.ID+',1)">上架</button>\
														  <button data-tid="'+o.ID+'" class="btn btn-sm btn-danger ml-3 btn-del" style="font-size:0.75rem; line-height:0.75rem;" onclick="del('+o.ID+')">删除</button>\
													  </td>\
												  </tr>';
											$("#list_table").append(html);
											var l=$("#list_table > tr").last();
											if(o.IsLocked==true){
												l.find('label').attr('class','badge badge-light').text('已下架');
												l.find('button.btn-down').css('display','none');
												l.find('button.btn-up').css('display','inline-block');

											}	
										});
										
									}else{
										var h='<tr><td>您还没有任分类</td></tr>';
										$("#list_table").append(h);
									}
								}

							})	
						}
						
						
						//删除产品分类
						function del(typeID){
							if(confirm("删除产品分类同时会删除该分类下的所有产品，且不能恢复，确认删除吗？")){
								$.post("https://customer.imotstudio.net/cabi/api/product/DeleteType?TypeID="+typeID).done(function(res){
									if(res.Code==200){
										alert("删除成功！");
										getTypeList();
									}else{
										alert("出现错误，请联系管理员");
									}
								})	
							}
						}
						
						//上架，下架产品
						function updown(typeID,isUp){
							if(isUp==0){
								if(confirm("下架产品后，该系列产品将不会对用户展示，确认下架吗？")){
									$.post("https://customer.imotstudio.net/cabi/api/product/DownUpProductType",{typeID:typeID,isUp:isUp}).done(function(res){
										console.log(res);
										getTypeList();
									})
								}
							}else{
								$.post("https://customer.imotstudio.net/cabi/api/product/DownUpProductType",{typeID:typeID,isUp:isUp}).done(function(res){
									console.log(res);
									getTypeList();
								})
							}
						}
						
					
					
					</script>
					
					
					
					
					<!-- InstanceEndEditable -->
				</div>
				
				<footer id="footer_rights">
				    <span>察必后台管理系统 Copyright © 2020  All rights reserved.</span>
					<a href="https://www.imotstudio.net" target="_blank">内蒙古元本唐文化传媒有限公司提供技术支持</a>
				</footer>
				  
			  </div>
			   
		  </div>

		</div>
		
		<!-- container-scroller -->
		<!-- plugins:js -->

		<!-- endinject -->
		<!-- Plugin js for this page-->
		<!-- End plugin js for this page-->
		<!-- inject:js -->
		<script src="js/off-canvas.js"></script>
		<script src="js/hoverable-collapse.js"></script>
		<script src="js/template.js"></script>
		<!-- endinject -->
		<!-- Custom js for this page-->
		<!-- End custom js for this page-->
	</body>
<!-- InstanceEnd --></html>
